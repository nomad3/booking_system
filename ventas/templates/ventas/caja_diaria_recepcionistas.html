<!-- ventas/templates/ventas/caja_diaria_recepcionistas.html -->
{% extends "admin/base_site.html" %}

{% load ventas_extras %}

{% block content %}
{% include 'base_menu.html' %}

<h1>Caja Diaria para Recepcionistas</h1>

<form method="get">
    <label for="fecha_inicio">Fecha Inicio:</label>
    <input type="date" name="fecha_inicio" value="{{ fecha_inicio }}">

    <label for="fecha_fin">Fecha Fin:</label>
    <input type="date" name="fecha_fin" value="{{ fecha_fin }}">

    <label for="metodo_pago">Método de Pago:</label>
    <select name="metodo_pago">
        <option value="">Todos</option>
        {% for key, value in METODOS_PAGO %}
            <option value="{{ key }}" {% if metodo_pago == key %}selected{% endif %}>{{ value }}</option>
        {% endfor %}
    </select>

    <label for="usuario">Usuario:</label>
    <select name="usuario">
        <option value="">Todos</option>
        {% for usuario in usuarios %}
            <option value="{{ usuario.id }}" {% if usuario_id == usuario.id %}selected{% endif %}>{{ usuario.username }}</option>
        {% endfor %}
    </select>

    <button type="submit">Filtrar</button>
</form>

<h2>Totales</h2>
<p>Total Ventas: {{ total_ventas }} CLP</p>
<p>Total Pagos: {{ total_pagos }} CLP</p>

<h2>Pagos Agrupados</h2>
<table>
    <thead>
        <tr>
            <th>Método de Pago</th>
            <th>Usuario</th>
            <th>Total Monto</th>
            <th>Cantidad de Transacciones</th>
        </tr>
    </thead>
    <tbody>
        {% for grupo in pagos_grouped %}
        <tr>
            <td>{{ grupo.metodo_pago }}</td>
            <td>{{ grupo.usuario__username }}</td>
            <td>{{ grupo.total_monto }}</td>
            <td>{{ grupo.cantidad_transacciones }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<h2>Ventas</h2>
<table>
    <thead>
        <tr>
            <th>ID VentaReserva</th>
            <th>Cliente</th>
            <th>Total</th>
            <th>Pagado</th>
            <th>Saldo Pendiente</th>
        </tr>
    </thead>
    <tbody>
        {% for venta in ventas %}
        <tr>
            <td>{{ venta.id }}</td>
            <td>{{ venta.cliente.nombre }}</td>
            <td>{{ venta.total }} CLP</td>
            <td>{{ venta.pagado }} CLP</td>
            <td>{{ venta.saldo_pendiente }} CLP</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}